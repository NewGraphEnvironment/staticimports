---
output: github_document
editor_options:
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# staticimports

<!-- badges: start -->
<!-- badges: end -->

**staticimports** provides utility functions that R programmers can use in their packages or other projects. The "static" part means that the functions are statically "imported" -- that is they copied into the project as text, instead of being loaded from a package at run time.

The benefits of doing things this way:

* A package/project that uses staticimports will not take a run-time dependency staticimports.
* Any changes to a function in **staticimports** will not affect a project that uses them, until the author decides to re-import them.
* You can specify the individual functions to import. This is faster and lighter-weight than loading a separate package, especially if the package has much more functionality than you need.
* There is zero commitment: After you use staticimports once, you never have to use it again.

Instead of copying and pasting utility functions from project to project, the utility functions can be centralized in **staticimports**, where they can be vetted and tested.

The functions in **staticimports** are designed to be:

* Fast
* Simple
* Have no external dependencies

If your project imports a function from **staticimports**, and that function changes in a way that has a negative impact on your project, you can simply stop importing it from **staticimports**, and copy the old version to a separate file.


## Installation

You can install the development version of staticimports with:

```{r eval=FALSE}
remotes::install_github("wch/staticimports")
```

## Usage

To use, put a comment block starting with `# @staticimports` in one of your R source files. For example, your `utils.R` may have this at the top:

```
# @staticimports
#  os_name %||%
#  map walk
```

This comment block names the functions to copy from staticimports. To do the import, run:

```{r eval=FALSE}
staticimports::import()
```

By default this will write these funcitons to a file `R/staticimports.R` in your project.

You examine the output by writing to `stdout()` instead of `R/staticimports.R`. Notice how importing `os_name` automatically brings in `is_windows`, `is_mac`, and `is_linux`.

```{r eval=FALSE}
staticimports::import(outfile = stdout())
```

```{r echo=FALSE}
staticimports::import_objs(c("os_name", "%||%", "map", "walk"), stdout())
```

For testing what the output will look like, you can use `import_objs()` to see what it looks like when you import specific objects by name:

```{r}
staticimports::import_objs(c("map", "walk"), stdout())
```


## TODO

* Figure out and explain licensing issues.
* Write license info in generated file.

## Some conventions

Note: This is currently just a dumping ground for ideas.

### Don't use `force()`

Two reasons:

* Error reporting
* Missing args

```{r error=TRUE}
with_option <- function(x, y) {
  force(x)
}

with_option(a = 123)

with_option2 <- function(x, y) {
  x
}

with_option2(a = 123)

err <- function() { stop("asdf") }

f()
```



### Don't use `match.arg()`

* `match.arg()` is slow, at least if values are inferred automatically.
